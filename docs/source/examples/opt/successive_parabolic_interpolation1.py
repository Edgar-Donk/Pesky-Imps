# finds extrema
# https://drlvk.github.io/nm/section-parabolic-interpolation.html
# https://ece.uwaterloo.ca/~dwharder/nm/Lecture_materials/pdfs/8.1.4%20Successive%20parabolic%20interpolation.pdf
# https://csg.sph.umich.edu/abecasis/class/2006/615.16.pdf
# expand
from math import pi
from prettytable import PrettyTable

f = lambda x: 2 * (pi*x**2 + 50/x) #x**4 - 3*x**2 + x + 1;
a = 1
b = 3
c = 5
fa = f(a)
fb = f(b)
fc = f(c)
t = PrettyTable(['step', 'a', 'b', 'c', 'x', 'fa', 'fb', 'fc', 'fx', 'emax'])

step = 0

while abs(max([a, b, c]) - min([a, b, c])) > 1e-6:
    x = b - ((b-a)**2*(fb-fc)-(b-c)**2*(fb-fa))/(2*((b-a)*(fb-fc)-(b-c)*(fb-fa)))

    t.add_row([step, round(a,7), round(b,7), round(c,7), round(x,7), \
        round(fa,7), round(fb,7), round(fc,7), round(f(x),7), round(abs(max([a, b, c]) - min([a, b, c])),7)])
    if fc > fa:
        c = b
        a = a/4+3*x/4
        b = x
        fc = fb
        fa = f(a)
        fb = f(b)
    else:
        a = b
        c = c/4+3*x/4
        b = x
        fa = fb
        fc = f(c)
        fb = f(b)

    step +=1
    if step > 19:
        break


print(t)
print(f'Found x = {c:.7} with f(x) = {f(c):.7} after {step-1} steps\n')

'''
+------+-----------+-----------+-----------+-----------+-------------+------------+-------------+------------+-----------+
| step |     a     |     b     |     c     |     x     |      fa     |     fb     |      fc     |     fx     |    emax   |
+------+-----------+-----------+-----------+-----------+-------------+------------+-------------+------------+-----------+
|  0   |     1     |     3     |     5     | 2.3166288 | 106.2831853 | 89.8820011 | 177.0796327 | 76.8865773 |     4     |
|  1   | 1.9874716 | 2.3166288 |     3     | 1.9551871 |  75.1340388 | 76.8865773 |  89.8820011 | 75.1650885 | 1.0125284 |
|  2   | 1.9632582 | 1.9551871 | 2.3166288 | 2.0000493 |  75.1535364 | 75.1650885 |  76.8865773 | 75.1327478 | 0.3614417 |
|  3   | 1.9908515 | 2.0000493 | 1.9551871 | 1.9964618 |  75.1331037 | 75.1327478 |  75.1650885 | 75.132507  | 0.0448623 |
|  4   | 1.9950593 | 1.9964618 | 2.0000493 | 1.9964736 |  75.1325447 | 75.132507  |  75.1327478 | 75.132507  | 0.0049901 |
|  5   |  1.99612  | 1.9964736 | 1.9964618 | 1.9964727 |  75.1325093 | 75.132507  |  75.132507  | 75.132507  | 0.0003536 |
|  6   | 1.9964736 | 1.9964727 |  1.99647  | 1.9964727 |  75.132507  | 75.132507  |  75.132507  | 75.132507  |  3.6e-06  |
+------+-----------+-----------+-----------+-----------+-------------+------------+-------------+------------+-----------+
Found x = 1.996473 with f(x) = 75.13251 after 6 steps
'''