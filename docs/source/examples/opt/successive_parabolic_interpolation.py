# finds extrema
# https://drlvk.github.io/nm/section-parabolic-interpolation.html
# https://ece.uwaterloo.ca/~dwharder/nm/Lecture_materials/pdfs/8.1.4%20Successive%20parabolic%20interpolation.pdf
# https://csg.sph.umich.edu/abecasis/class/2006/615.16.pdf
# expand
from math import pi
from prettytable import PrettyTable

f = lambda x: 2 * (pi*x**2 + 50/x) #x**4 - 3*x**2 + x + 1;
a = 1
b = 3
c = 5
fa = f(a)
fb = f(b)
fc = f(c)
t = PrettyTable(['step', 'a', 'b', 'c', 'x', 'fa', 'fb', 'fc', 'fx', 'emax'])

step = 0
t.add_row([step, round(a,7), round(b,7), round(c,7), None, \
        round(fa,7), round(fb,7), round(fc,7), None, round(abs(max([a, b, c]) - min([a, b, c])),7)])

while abs(max([a, b, c]) - min([a, b, c])) > 1e-6:
    alpha = (fb-fa)/(b-a)
    beta = (fc-fa-alpha*(c-a))/((c-a)*(c-b))
    x = (a+b)/2 - alpha/(2*beta)
    step +=1
    t.add_row([step, round(a,7), round(b,7), round(c,7), round(x,7), \
        round(fa,7), round(fb,7), round(fc,7), round(f(x),7), round(abs(max([a, b, c]) - min([a, b, c])),7)])
    a = b
    b = c
    c = x
    fa = fb
    fb = fc
    fc = f(c)

    if step > 19:
        break

print(t)
print(f'Found x = {c:.7} with f(x) = {f(c):.7} after {step} steps\n')

'''
+------+-----------+-----------+-----------+-----------+-------------+-------------+-------------+------------+-----------+
| step |     a     |     b     |     c     |     x     |      fa     |      fb     |      fc     |     fx     |    emax   |
+------+-----------+-----------+-----------+-----------+-------------+-------------+-------------+------------+-----------+
|  0   |     5     |     3     |     1     |    None   | 177.0796327 |  89.8820011 | 106.2831853 |    None    |     4     |
|  1   |     5     |     3     |     1     | 2.3166288 | 177.0796327 |  89.8820011 | 106.2831853 | 76.8865773 |     4     |
|  2   |     3     |     1     | 2.3166288 | 2.1983511 |  89.8820011 | 106.2831853 |  76.8865773 | 75.8536877 |     2     |
|  3   |     1     | 2.3166288 | 2.1983511 | 2.0890269 | 106.2831853 |  76.8865773 |  75.8536877 | 75.2892082 | 1.3166288 |
|  4   | 2.3166288 | 2.1983511 | 2.0890269 | 1.9790689 |  76.8865773 |  75.8536877 |  75.2892082 | 75.1382498 | 0.2276019 |
|  5   | 2.1983511 | 2.0890269 | 1.9790689 |  1.994337 |  75.8536877 |  75.2892082 |  75.1382498 | 75.132593  | 0.2192822 |
|  6   | 2.0890269 | 1.9790689 |  1.994337 | 1.9967646 |  75.2892082 |  75.1382498 |  75.132593  | 75.1325086 |  0.109958 |
|  7   | 1.9790689 |  1.994337 | 1.9967646 | 1.9964674 |  75.1382498 |  75.132593  |  75.1325086 | 75.132507  | 0.0176957 |
|  8   |  1.994337 | 1.9967646 | 1.9964674 | 1.9964728 |  75.132593  |  75.1325086 |  75.132507  | 75.132507  | 0.0024276 |
|  9   | 1.9967646 | 1.9964674 | 1.9964728 | 1.9964727 |  75.1325086 |  75.132507  |  75.132507  | 75.132507  | 0.0002972 |
|  10  | 1.9964674 | 1.9964728 | 1.9964727 | 1.9964727 |  75.132507  |  75.132507  |  75.132507  | 75.132507  |  5.4e-06  |
+------+-----------+-----------+-----------+-----------+-------------+-------------+-------------+------------+-----------+
Found x = 1.996473 with f(x) = 75.13251 after 10 steps
'''